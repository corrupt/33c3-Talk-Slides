\documentclass[
	aspectratio=169,
	xetex,
	%notes,
]{beamer}
%\usepackage{pgfpages}
%\setbeameroption{show notes}
%\setbeameroption{show notes on second screen=bottom}
\usepackage{pdfcomment}

\usetheme[
	%titleformat=smallcaps,
	background=dark,
	progressbar=frametitle,
	numbering=none,
]{metropolis}
\usecolortheme{owl}

\usepackage{appendixnumberbeamer}

\usepackage{booktabs}
\usepackage[scale=2]{ccicons}

\usepackage{pgfplots}
\usepgfplotslibrary{dateplot}
\usepackage[]{graphicx}
\usepackage[]{url}
%\usepackage[utf8]{inputenc} % only needed if not using xetex
\usepackage[]{hyperref}
\usepackage[english]{babel}

%-----8<------------8<------------8<------------8<------------8<------------8<------------

\newfontfamily\fontfoundation[
    Path=fonts/
]{foundation-icons.ttf}
\newlength\fsize
\newcommand*\icon[3]{{
	\setlength\fsize{#2pt}%
	\fontsize{\fsize}{#3\fsize}\fontfoundation{#1}
}}

\newcommand\icontwitter[2][1.2]{\icon{}{#2}{#1}}
\newcommand\iconmail[2][1.2]{\icon{}{#2}{#1}}

%-----8<------------8<------------8<------------8<------------8<------------8<------------

%% When using Metropolis
%\setbeamercolor{frametitle}{%
%	fg=black!2,
%	bg=mDarkTeal
%}

%-----8<------------8<------------8<------------8<------------8<------------8<------------

\title{A look into the Mobile Messaging Black Box}
\subtitle{\scriptsize{33$^{\mathsf{rd}}$ Chaos Commmunication Congress \#33c3}}
\date{\today}
\author{
	\parbox[t]{1.2in}{Roland Schilling}{\scriptsize{\ttfamily @NerdingByDoing}}\\
	\parbox[t]{1.2in}{Frieder Steinmetz}{\scriptsize{\ttfamily @twillnix}}
}

\makeatletter
\hypersetup{
	pdfauthor=Roland Schilling \& Frieder Steinmetz,
    pdftitle={\@title},
    pdfsubject={Mobile Instant Messaging},
    pdfkeywords={Signal} {Threema} {33c3} {messaging} {reverse-engineering},
}\makeatother

\institute{Hamburg University of Technology\\
Security in Distributed Applications}
% \titlegraphic{\hfill\includegraphics[height=1.5cm]{logo.pdf}}


%-----8<------------8<------------8<------------8<------------8<------------8<------------

% stuff for arbitrary image placement
% http://tex.stackexchange.com/questions/16357/how-can-i-position-an-image-in-an-arbitrary-position-in-beamer
\tikzset{
  corner node/.style={
    anchor=south east,xshift=-.5cm,yshift=.5cm,
  },
}
\def\tikzoverlay{%
   \tikz[overlay,remember picture]\node[corner node]
}%

%-----8<------------8<------------8<------------8<------------8<------------8<------------

\begin{document}

\maketitle

%\section{Introduction}

\begin{frame}[t]
	\frametitle{Messaging - An Analogy}
	\begin{itemize}
		\item You're at a party
		\item Friend approaches you and needs to tell you something \alert{in private}
		\item What do you expect when you say \alert{private}?
		\item You enter a separate room, you trust the location
		\item What does a separate room offer you?
	\end{itemize}
	\pdfcomment{Confidentiality}
	\pdfcomment{Authenticity}
	\pdfcomment{Integrity}
	\pdfcomment{Forward Secrecy}
	\pdfcomment{Future Secrecy}
	\pdfcomment{Deniability}
	\vfill
	\tikzoverlay at (current page.south east){
		\includegraphics[width=5cm]{img/party.pdf}
	};
\end{frame}

\begin{frame}
	\frametitle{A Private Room}
	You are now alone in a closed room with your Friend
	\begin{itemize}
		\item Both of you have absolute Confidentiality that you are alone
		\item Nobody can overhear your talk
		\item Your exchange is completely private
	\end{itemize}
	We call this \alert{confidentiality}

	\tikzoverlay at (current page.south east){
		\includegraphics[width=6cm]{img/conversation.pdf}
	};

\end{frame}


\begin{frame}
	\frametitle{In Sight of Each Other}
	The room you're in is small enough that you can always see each other
	\begin{itemize}
		\item You know that the words you speak are received just as you spoke them
		\item There is no way either of you hears something other than the other says
	\end{itemize}
	We call this \alert{integrity}
\end{frame}

\begin{frame}
	\frametitle{You Know Each Other}
	Since you're long-time friends, you're absolutely sure, whom you're talking to
	\begin{itemize}
		\item Nobody can impersonate your friend or you, without the other noticing
		\item You're talking directly, without a phone or webcam in between
	\end{itemize}
	We call this \alert{authenticity}
\end{frame}

\begin{frame}
	\frametitle{It's a One-Time Talk}
	\only<1>{%
	Suppose somebody steps into the room
	\begin{itemize}
		\item They could overhear your conversation
		\item They would only learn the contents of this particular conversation
		\item They would not learn anything about past conversations you had
	\end{itemize}
	We call this \alert{forward secrecy}
	\begin{itemize}
		\item[$\rightarrow$] After leaving they would not be able to listen to any future conversations you might have
	\end{itemize}
	We call this \alert{future secrecy}}
	\pdfcomment{Future Secrecy is also called post-compromise security}
	\only<2>{%
		Perfect Forward- and Future Secrecy\\\pdfcomment{Diese Folie muss an eine andere Stelle wandern}
		\begin{center}
			\includegraphics[width=\textwidth]{img/pfs-simple.pdf}
		\end{center}
	}
\end{frame}

\begin{frame}
	\frametitle{It's a One-Time Talk Between Only You Two}
	There are no witnesses in the room
	\begin{itemize}
		\item Either of you can later deny to other having made any statement
		\item Neither of you can prove to other that any of you have made a particular statement
	\end{itemize}
	We call this \alert{deniability}
\end{frame}

%\section{Enter Messaging Services}

\begin{frame}
	\frametitle{Messaging}
	\only<1>{%
		\centering
		\includegraphics[width=.75\textwidth]{img/messaging.pdf}	
	}
	% \only<2>{%
	% 	Parties involved
	% 	\begin{itemize}
	% 		\item Depending on the scenario, at least one additional party is involved, the messaging provider
	% 		\item push message provider might also be involved
	% 		\item In federated scenarios, multiple relaying parties may be involved
	% 		\item[$\Rightarrow$] Messaging solutions should be designed so as to minimized the data these parties may obtain
	% 	\end{itemize}
	% 	Problems:
	% 	\begin{itemize}
	% 		\item How to find your peers? (address book leakage)
	% 		\item How to relay messages to the recipient? (participation leakage)
	% 		\item Relay always knows the exact time a message was sent
	% 		\item Relay always knows the size of transmitted messages (padding helps)
	% 	\end{itemize}
	% }
\end{frame}

\begin{frame}
	\frametitle{Traditional Messaging}
	What if this conversation had taken place via SMS?\\[1em]
	\begin{minipage}[t][.7\textheight]{\textwidth}
		\only<1>{\pdfcomment{As can be seen, our conversation analogy (and therefore our expectations) translates badly to the world of messaging. We need a new analogy. -- transition to next slide}
			Your providers (and other people on the same network)
			\begin{itemize}
				\item would know the contents of your exchange: \alert{no confidentiality}
				\item could change the contents of your exchange: \alert{no integrity}
				\item could reroute your messages and impersonate either of you: \alert{no authentication}
				\item would know all messages you ever exchanged: \alert{no forward Secrecy}
				\item would know all messages exchanged in the future: \alert{no future secrecy}
				\item could store all messages and use them as proof of the exchange: \alert{no deniability}
			\end{itemize}
		}
	\end{minipage}
	\only<1->{$\rightarrow$ Messaging translates badly to our offline communication expectation}
\end{frame}

\begin{frame}
	\frametitle{A Better Analogy}
	\only<1>{
		We started with a conversation analogy to identify our expectations of messaging\\[12pt]
		$\rightarrow$ Actually \alert{postal services} are better to look at messaging from a technical point of view.\\[24pt]
		\begin{center}
			\begin{tikzpicture}
				\node at (0,0) [anchor=east]   {\includegraphics[width=2cm]{img/phone-chat.pdf}};
				\node at (2,0) [text height=2cm] {\fontsize{3cm}{3cm}\selectfont =\kern-.3ex>};
				\node at (4,0) [anchor=west]   {\includegraphics[width=5cm]{img/letter-example.pdf}};
			\end{tikzpicture}
		\end{center}
	}
	\onslide<2->{
		\centering
		\includegraphics[width=.2\textwidth]{img/postcard.pdf}
		\-\\[2em]
	}
	\onslide<3>{
		\centering
		\includegraphics[width=.3\textwidth]{img/letter-to-envelope.pdf}
		\pdfcomment{Now we have established an analogy of our expectations and one a bit closer to the communication relality. Now let's compare and evaluate both.}
		\pdfcomment{We start by looking at the envelope and asking how we can do that. -> Short encryption to cryptography.}
	}
\end{frame}

\begin{frame}[t]
	%weird constructs on this slide to prevent image jumping on overlay stepping
	\frametitle{The Shortest Introduction to Encryption You Will Ever Get}
		\vspace{-1ex}
		\onslide<1->{
			\begin{minipage}[t][.46\textheight]{\textwidth}
				Symmetric Encryption:\\
				\quad\small\alert{$\rightarrow$} Encryption and decryption  with the same key
				\begin{center}
					\only<1>{\includegraphics[width=.8\textwidth]{img/symmetric_crypto-1.pdf}\\[2ex]}
					\only<2->{\includegraphics[width=.8\textwidth]{img/symmetric_crypto.pdf}\\[2ex]}
				\end{center}
		\end{minipage}
			}
		\onslide<3->{
			Asymmetric Encryption:\\
			\quad\small\alert{$\rightarrow$} Encryption and decryption with different keys
			\begin{center}
				\only<3>{\includegraphics[width=.8\textwidth]{img/asymmetric_crypto.pdf}}
				\only<4>{\includegraphics[width=.8\textwidth]{img/asymmetric_crypto-2.pdf}}
			\end{center}
		}
\end{frame}

\begin{frame}
	\frametitle{Public-Key Cryptography -- In a Nutshell}
	\vspace{3mm}
	\begin{minipage}[t][.65\textheight]{\textwidth}
		\begin{center}
			\only<1-2>{
				\includegraphics[width=\textwidth]{img/alice-bob-pki.pdf}\\[1.5em]
				\onslide<2>{\includegraphics[width=.7\textwidth]{img/asymmetric_crypto-2.pdf}}
			}
			\only<3>{
				\includegraphics[width=\textwidth]{img/pki-msg-exchange.pdf}
			}
		\end{center}
	%\onslide<3->
	\end{minipage}

	\begin{itemize}
		\item Both parties publish their identities and public keys
		\item Any message can be encrypted with anyone's public key and only be decrypted with its corresponding secret key
	\end{itemize}

\end{frame}

\begin{frame}
	\frametitle{Recap}
	\begin{itemize}
		\item Hier steht ein Recap
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Confidentiality}
	\centering
	\includegraphics[width=.8\textwidth]{img/confidentiality.pdf}
\end{frame}

\begin{frame}
	\frametitle{Deniability}
	\only<1>{
		\centering
		\-\\[2em]
		\includegraphics[width=.8\textwidth]{img/deniability-letter.pdf}
		\pdfcomment{Public-Key Authenticators einfach erklären für Deniability}
	}
	\begin{overlayarea}{\textwidth}{\textheight}
		\begin{itemize}
			\item<2-> In asymmetric cryptography, it is always clear who sent a message, once the protocol is broken on either side
			\item<3-> It can, however, be used to exchange a symmetric key that either parties share
			\item<4-> Now either Party can deny authoring any message
		\end{itemize}
		\-\\
		\begin{center}
			\only<2>{\includegraphics[width=.8\textwidth]{img/no-deniability.pdf}\pdfcomment{now our hacker has managed to break into Bob's phone and can look at the messages}}
			\only<3->{\includegraphics[width=.8\textwidth]{img/key-agreement.pdf}}
		\end{center} 
	\end{overlayarea} 
\end{frame} 

\begin{frame}
	\frametitle{Forward- and Future Secrecy}
	\begin{center}
		\only<1>{\pdfcomment{We remember our simple explanation of PFS}
			\includegraphics[width=\textwidth]{img/pfs-simple.pdf}
		}
		\only<2>{\pdfcomment{now we transfer this image to messaging}
			\includegraphics[width=\textwidth]{img/pfs.pdf}
		}
		\pdfcomment{The easiest way to do this is to discard each key after one use and exchange a new one}
		\pdfcomment{Of course this has to happen in a way that no attacker with a stolen key learns anything about the next one}
		\onslide<3->{
			\includegraphics[width=.9\textwidth]{img/e2e-symmetric.pdf}
			\-\\[1em]\pause
		}
		\onslide<4->{
			\includegraphics[width=.4\textwidth]{img/discard-key.pdf}
		}
	\end{center}
\end{frame}

\begin{frame}
	\frametitle{Recap}
	\begin{itemize}
		\item Hier steht ein Recap
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Key Management}
	\only<1>{%
		\centering
		\begin{block}{}
			Cryptography is rarely, if ever, the solution to a security problem. Cryptography is a translation mechanism, usually converting a communications security problem into a key management problem.\\
			\hfill ---Dieter Gollmann
		\end{block}
	}
	\only<2>{
		\pdfcomment{Put better content here}
		\begin{itemize}
			\item How does Alice know which is Bob's public key?
			\item Identity keys stored on devices, what if stolen
			\item Keys for back-end communication layer hard-coded, almost impossible to replace
			\item How to deal with key compromise? (answer: key rotation)
		\end{itemize}
	}
	\only<3>{
		\centering
		\includegraphics[width=.9\textwidth]{img/identity-query.pdf}
	}
\end{frame}

\begin{frame}
	\frametitle{Authenticity}
	\begin{itemize}
		\item How to connect a key to a person?
			\begin{itemize}
				\item[$\rightarrow$] Key signing (PGP)
				\item[$\rightarrow$] Certificates (trusted third party)
				\item[$\rightarrow$] (Messenger-)service-based directory (based on phone numbers or email addresses)
					\pdfcomment{It is not a good idea to use phone numbers for identities, we rather want a separate ID. That's where Threema's approach is interesting}
			\end{itemize}
		\item How to deal with changing keys?
			\begin{itemize}
				\item warnings are annoying
				\item Threema's traffic light system encourages authentication but doesn't deal with changing keys (other than new identities for known phone numbers with yellow dots)
			\end{itemize}

	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Metadata Handling}
	\only<1>{%
		Everybody on the network can see:
		\begin{itemize}
			\item\alert{the sender} of the message
			\item\alert{the intended receiver} of the message
				\pdfcomment{They can also log the time and the size of the messages}
		\end{itemize}
		\begin{center}\includegraphics[width=5cm]{img/metadata-leak.pdf}\end{center}
	}
	\only<2>{
		Solution: wrap encrypted message in a second layer of encryption and address it only to the message server.
		\begin{center}
			\includegraphics[width=.8\textwidth]{img/transport-layer-encryption.pdf}
		\end{center}
	}
	\only<3>{
		\begin{center}
			\includegraphics[width=.8\textwidth]{img/everybody-sends.pdf}
		\end{center}
	}
	\only<4>{
		\begin{center}
			\includegraphics[width=.8\textwidth]{img/transport-layer-encryption-forwarding.pdf}
		\end{center}
	}
	\only<5>{
		The message server will remove the outer layer and add a new one, targeted at the receiver.
		\begin{center}
			\includegraphics[width=.8\textwidth]{img/transport-layer-encryption-receiving.pdf}
		\end{center}
	}
	\only<6>{
		This leaves us with an encrypted \alert{end-to-end tunnel}, transmitted through two \alert{transport layer} encryption tunnels.\\
		\vspace{1cm}
		\begin{center}
			\includegraphics[width=\textwidth]{img/2-layer-tunnel.pdf}
		\end{center}
		\vspace{1cm}
		\alert{The message server still knows both communication partners!}
	}
		\only<7->{
			We can obfuscate the size of a message with \alert{padding}\\
			\-\\[2em]
		}
	\begin{overlayarea}{\textwidth}{\textheight}
		\only<8>{
			\begin{center}
				\includegraphics[width=.7\textwidth]{img/padding.pdf}
			\end{center}
			\pdfcomment{Of course padding should be randomly different every time}
		}

		% \onslide<9>{
		% 	\begin{center}
		% 		\includegraphics[page=13,clip,trim={.99cm 7.5cm 5cm 1cm},width=.9\textwidth]{out/messages.pdf}
		% 	\end{center}
		% }
	\end{overlayarea}
\end{frame}

\begin{frame}
	Threema Architecture
	\pdfcomment{Coversation starts with Directory Server}
	\pdfcomment{Messaging server is the most essential}
	\pdfcomment{MediaServer is for transmission of big files, will e explained later}
\end{frame}

\begin{frame}
	Threema Fingerprints
	\pdfcomment{Tackles the PKI problem explained earlier}
	\pdfcomment{Solution is pretty good. Reason why we chose 3ma}
	\pdfcomment{Less trust in Keys from Directory Server based on Threema ID}
	\pdfcomment{	more if based on phone number and email}
	\pdfcomment{	most if verified by qr}
\end{frame}

\begin{frame}
	NaCl
	\pdfcomment{NaCl exists and it works as roland explained in "autheticated encryption"}
	\pdfcomment{3ma uses it}
	\pdfcomment{c = crypto_box(msg,nonce,pk,sk)}
\end{frame}


\begin{frame}[t]
	\frametitle{Threema's App-to-Server Handshake}
	\begin{overlayarea}{\textwidth}{\textheight}
		\begin{columns}
			\begin{column}[t]{.3\textwidth}
				\begin{overlayarea}{\textwidth}{\textheight}
					\only<1>{\includegraphics[width=\textwidth]{img/handshake.pdf}}	
					\only<2>{\includegraphics[width=\textwidth]{img/handshake-1.pdf}}	
					\only<3>{\includegraphics[width=\textwidth]{img/handshake-2.pdf}}	
					\only<4>{\includegraphics[width=\textwidth]{img/handshake-3.pdf}}	
					\only<5>{\includegraphics[width=\textwidth]{img/handshake-4.pdf}}	
				\end{overlayarea}
			\end{column}
			\begin{column}[t]{.01\textwidth}
			%padding
			\end{column}
			\begin{column}[t]{.69\textwidth}
				\begin{overlayarea}{\textwidth}{\textheight}
					\-\\%invisible line break
					\only<1>{%
						Initial Text goes here
					}
					\only<2>{%
						{\large Client Hello Packet}\\[1ex]
						\includegraphics[page=11,clip,trim={.99cm 9cm 3.2cm 2.55cm},width=\textwidth]{out/messages.pdf}
						\begin{itemize}
							\item Client generates a \alert{ephemeral} key pair
							\item Client generates random nonce prefix
						\end{itemize}
					}	
					\only<3>{%
						{\large Server Hello Packet}\\[1ex]
						\includegraphics[page=11,clip,trim={.99cm 3.5cm 3.2cm 6.9cm},width=\textwidth]{out/messages.pdf}
						\begin{itemize}
							\item Server generates \alert{ephemeral} key pair
							\item Server generates random nonce
							\item Ciphertext encrypted with Server Nonce, Client Ephemeral Key and Server Long-Term Key
						\end{itemize}
						\pdfcomment{Ciphertext is is not readable by someone with clients LTK (forward sec).}
						\pdfcomment{Proves servers possesion of LTK}
					}	
					\only<4>{%
						{\large Client Authentication Packet}\\[1ex]
						\includegraphics[page=12,clip,trim={.99cm 10cm 3.2cm 1.5cm},width=\textwidth]{out/messages.pdf}
						\begin{itemize}
							\item Outer Encryption with ephemral Keys
							\item Ciphertext links clients ephemeral key pair to it's long term key pair
						\end{itemize}
					}	
					\only<5>{%
						{\large Server Acknowledgement Packet}\\[1ex]
						\includegraphics[page=12,clip,trim={.99cm 7cm 3.2cm 6.2cm},width=\textwidth]{out/messages.pdf}
						\begin{itemize}
							\item Server comfirms everything wokred fine by encrypting something with both ephemeral keys
						\end{itemize}
					}	
				\end{overlayarea} \end{column}
		\end{columns}
	\end{overlayarea}
\end{frame}

\begin{frame}
		\begin{center}\includegraphics[width=\textwidth]{img/2-layer-tunnel.pdf}\end{center}
		Lila und Gruen sind klar\\
		Jetzt noch kurz rot
\end{frame}

\begin{frame}
	\frametitle{Threema Packet Format}

	\includegraphics[page=1,clip,trim={.99cm 8cm 3.2cm 1.8cm},width=\textwidth]{out/messages.pdf}

\end{frame}

\begin{frame}
	\frametitle{Threema Text Messages}
	\includegraphics[page=3,clip,trim={.99cm 7.5cm 3.2cm 1.8cm},width=\textwidth]{out/messages.pdf}
\end{frame}

\begin{frame}
	\frametitle{Threema Image Messages}
	\includegraphics[page=4,clip,trim={.99cm 7.5cm 3.2cm 1.8cm},width=\textwidth]{out/messages.pdf}
\end{frame}


\begin{frame}
	\frametitle{Sending an Image Message}
	\-\\[2em]
	\begin{overlayarea}{\textwidth}{\textheight}
		\only<1>{\includegraphics[width=\textwidth]{img/threema-architecture-1.pdf}}
		\only<2>{\includegraphics[width=\textwidth]{img/threema-architecture-2.pdf}}
		\only<3>{\includegraphics[width=\textwidth]{img/threema-architecture-3.pdf}}
		\only<4>{\includegraphics[width=\textwidth]{img/threema-architecture-4.pdf}}
		\only<5>{\includegraphics[width=\textwidth]{img/threema-architecture-5.pdf}}
		\only<6>{\includegraphics[width=\textwidth]{img/threema-architecture.pdf}}
	\end{overlayarea}
\end{frame}


% \begin{frame}
% 	\frametitle{Threema: Special Messages}
% 	\begin{itemize}
% 		\item Polls
% 		\item Images with Caption
% 			\begin{itemize}
% 				\item Case of caption leak found
% 			\end{itemize}
% 		\item Audio Messages
% 			\begin{itemize}
% 				\item Leak Android version
% 				\item Possible StageFright vector
% 			\end{itemize}
% 	\end{itemize}
% \end{frame}

% \begin{frame}
% 	\frametitle{Threema Audio Messages}
% 	\includegraphics[page=5,clip,trim={.99cm 7.5cm 3.2cm 1.8cm},width=\textwidth]{out/messages.pdf}
% \end{frame}

% \begin{frame}
% 	\frametitle{Threema Audio Messages -- Notes}
% 	\begin{itemize}
% 		\item Audio length is lost on forwarding
% 	\end{itemize}
% \end{frame}

\begin{frame}
	\frametitle{Group Messages}
	\includegraphics[page=6,clip,trim={.99cm 7.5cm 3.2cm 1.8cm},width=\textwidth]{out/messages.pdf}
\end{frame}

\begin{frame}
	\frametitle{Group Messages}
	\begin{itemize}
		\item Group IDs aren't unique. They are created locally and only work together with the group creator's ID
		\item The structure of group messages makes it impossible for Threema to introduce multiple group administrators on a protocol level without breaking compatibility to older clients.
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{The Devil's in the Detail}
	Sammlung kleinerer Dinge, die uns aufgefallen sind
	\begin{itemize}
		\item Media messages could be StageFright attach vectors
		\item The protocol implementation looks sound to us but the message design prevents feature upgrades on the protocol (not text-protocol) level

	\end{itemize}
\end{frame}


\begin{frame}
	\frametitle{Threema - Notes and Open Questions}
	Notes:
	\begin{itemize}
		\item PFS only on transport layer (attacker sniffing packets from the outside will not learn contents after private key acquisition)
	\end{itemize}
	Q:
	\begin{itemize}
		\item How often is the handshake performed?
	\end{itemize}
\end{frame}

%\section{Case Study - Signal}

\begin{frame}
	\frametitle{Signal Forward and Future Secrecy}
	\begin{itemize}
		\item If you want forward secrecy, you need to use asymmetric crypto and dispose of your keys as often as possible
		\item To do that you need to perform a new handshake frequently
		\item Since it is not always given that both parties are online for that handshake, the good people of Whispersystems have come up with this:
			\begin{enumerate}
				\item Both parties upload a bunch of keys to the server. Those are signed identity keys as we've seen previously and a large number of \alert{prekeys}
				\item Using a prekey, any party can perform their part of the handshake offline and end up with a new session key to use 
				\item These session keys are renewed by \alert{ratcheting} with each message transfer
			\end{enumerate}
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Signal - Notes}
	\begin{itemize}
		\item Server-side cached short-term keys (\alert{prekeys}) fetched by sender
		\item Pairwise long-lived symmetric secret key between participants
		\item Multiple messages without answer $\rightarrow$ perform KDF on \alert{chaining key}
		\item ECDH: Curve25519, AES-CTR (no padding), AES-CBC (PKCS7 padding)
		\item HMAC-SHA256 for integrity
		\item Future secrecy only if private keys are not leaked (duh!). Since private keys go into new shared keys during ratcheting, the attacker lacks material to compromise next key after obtaining current one.
		\item Since shared keys are only deleted after messages are received, there is a window in which keys could be compromised before reception. 
		\item Deniability is always a theoretical claim as long as a transmission server has the ability to log messages, their senders and recipients.

	\end{itemize}
\end{frame}

%\section{Reverse-Engineering Threema}

\begin{frame}
	\frametitle{Enter Threema}
	Threema
	\begin{itemize}
		\item Gained popularity in Germany after Facebook purchased WhatsApp
		\item All promise -- no proof; first openly contemplating to OSS the code, later backing away from that statement
		\item Interest in its inner workings
	\end{itemize}

	Quick Shoutouts
	\begin{itemize}
		\item Jan Ahrens for releasing his findings about the handshake before we did
		\item OpenMittsu for releasing the first working OSS client
	\end{itemize}
	
\end{frame}

\begin{frame}
	\frametitle{Reverse-Engineering -- What to look for?}
\begin{itemize}
	\item Test for common pitfalls in implementation
		\begin{itemize}
			\item Handling of TLS
			\item Handling of keys and nonces
			\item NaCl implementation errors
			\item Uncommon data leaks
			\item Bugs
			\item \ldots?
		\end{itemize}
	\item Find out how protocol is designed
		\begin{enumerate}
			\item Understand handshakes
			\item Understand protocol
			\item decipher messages
		\end{enumerate}
\end{itemize}
\alert{Positive side-note}: Threema had released a security white paper early on
\end{frame}

\begin{frame}[plain]
	\frametitle{Done!}
	{\Huge\bfseries Thank You!} \\[2em]
	\begin{columns}[t]
		\begin{column}[t]{.3\textwidth}
			\textbf{Roland Schilling}\\[.8ex]
			\begin{tabular}{rl}
				\parbox[c]{1ex}{\iconmail{15}}    & \scriptsize{\url{schilling@tuhh.de}}\\
				\parbox[c]{1ex}{\icontwitter{15}} & \scriptsize{\url{@NerdingByDoing}}\\
			\end{tabular}
		\end{column}
		\begin{column}[t]{.635\textwidth}
			\textbf{Frieder Steinmetz\phantom{g}}\\[.8ex] %phantom-g because \\ doesn't align to baseline
			\begin{tabular}{rl}
				\parbox[c]{1ex}{\iconmail{15}}    & \scriptsize{\url{frieder.steinmetz@tuhh.de}}\\
				\parbox[c]{1ex}{\icontwitter{15}} & \scriptsize{\url{@twillnix}}\\
			\end{tabular}
		\end{column}
	\end{columns}
	\alert{\rule{.75\textwidth}{1pt}}\\[1em]
	\scriptsize
	\begin{tabular}{@{}ll}
		Beamer Theme: & \alert{\href{https://github.com/matze/mtheme}{Metropolis}} by Matthias volgelsang\\
		Color Theme: & \alert{\href{https://github.com/rchurchley/beamercolortheme-owl}{Owl}} by Ross Chirchley \\
		Icons: & \alert{\href{https://thenounproject.com/mockturtle/collection/big/}{The BIG collection}} by Sergey Demushkin\\
		 & \alert{\href{http://zurb.com/playground/foundation-icon-fonts-3}{Foundation Icon Fonts 3}} by ZURB\\
	\end{tabular}\\[2em]
	Thanks to \alert{Jan Ahrens} and \alert{Philipp Berger} -- their work has made ours somewhat easier\\
	Thanks to \alert{Maximilian Köstler} for his initial work on Threema

\end{frame}

\end{document}

% vim: spelllang=en spell
